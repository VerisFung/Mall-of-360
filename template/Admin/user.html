{include file="Admin/include/header.html"}
{include file="Admin/include/sidebar.html"}

<!-- 增加用户框 -->
<div class="modal fade" id="addUserModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">添加用户</h4>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <label for="input-email" class="control-label">邮箱:</label>
            <input type="text" class="form-control" id="input-email">
          </div>
          <div class="form-group">
            <label for="input-username" class="control-label">用户名:</label>
            <input type="text" class="form-control" id="input-username">
          </div>
          <div class="form-group">
            <label for="input-password" class="control-label">密码:</label>
            <input type="text" class="form-control" id="input-password">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
        <button type="button" class="btn btn-success" id="btn-addUser">添加</button>
      </div>
    </div>
  </div>
</div>
<!-- 增加用户组框 -->
<div class="modal fade" id="addGroupModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">添加用户组</h4>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <label for="input-groupname" class="control-label">用户组名:</label>
            <input type="text" class="form-control" id="input-groupname">
          </div>
          <div class="form-group">
            <label for="input-discount" class="control-label">折扣率:</label>
            <input type="text" class="form-control" id="input-discount">
          </div>
          <div class="form-group">
            <label for="input-minexp" class="control-label">最小经验:</label>
            <input type="text" class="form-control" id="input-minexp">
          </div>
          <div class="form-group">
            <label for="input-maxexp" class="control-label">最大经验:</label>
            <input type="text" class="form-control" id="input-maxexp">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal" id="btn-addGroupClose">关闭</button>
        <button type="button" class="btn btn-success" id="btn-addGroup">添加</button>
      </div>
    </div>
  </div>
</div>
<!-- 修改用户组框 -->
<div class="modal fade" id="editGroupModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">编辑用户组</h4>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <label for="input-editgroupname" class="control-label">用户组名:</label>
            <input type="hidden" class="form-control" id="input-editgroupid">
            <input type="text" class="form-control" id="input-editgroupname">
          </div>
          <div class="form-group">
            <label for="input-editdiscount" class="control-label">折扣率:</label>
            <input type="text" class="form-control" id="input-editdiscount">
          </div>
          <div class="form-group">
            <label for="input-editminexp" class="control-label">最小经验:</label>
            <input type="text" class="form-control" id="input-editminexp">
          </div>
          <div class="form-group">
            <label for="input-editmaxexp" class="control-label">最大经验:</label>
            <input type="text" class="form-control" id="input-editmaxexp">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal" id="btn-editGroupClose">关闭</button>
        <button type="button" class="btn btn-success" id="btn-editGroup">保存</button>
      </div>
    </div>
  </div>
</div>
        <div class="container maincontent">
            <div class="row">
                <div class="alert alert-success alert-dismissible fade in" id="saveOk" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <span class="glyphicon glyphicon-ok"></span> 设置保存成功！
                </div>
                <div class="alert alert-danger alert-dismissible fade in" id="saveError" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <span class="glyphicon glyphicon-remove"></span> 设置保存失败！
                </div>
                <div role="tabpanel">
                    <!-- Nav tabs -->
                    <ul class="nav nav-tabs" role="tablist">
                        <li role="presentation" class="active"><a href="#userList" aria-controls="userList" role="tab" data-toggle="tab"><span class="glyphicon glyphicon-th-list"></span> 用户</a></li>
                        <li role="presentation"><a href="#groupList" aria-controls="groupList" role="tab" data-toggle="tab"><span class="glyphicon glyphicon-th-large"></span> 用户组</a></li>
                    </ul>
                    <!-- Tab panes -->
                    <div class="tab-content">

                        <!-- 用户 -->
                        <div role="tabpanel" class="tab-pane fade in active" id="userList">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-horizontal">
                                        <div class="form-group">
                                            <div class="col-md-7">
                                                <a class="btn btn-success" data-toggle="modal" data-target="#addUserModal"><span class="glyphicon glyphicon-plus"></span> 添加用户</a>
                                                <a class="btn btn-info" id="btn-addranduser" href="{U('admin/addranduser')}" target="_blank"><span class="glyphicon glyphicon-plus"></span> 添加机器人</a>
                                                {if count($userList)>0 }
                                                <a class="btn btn-primary" id="checkAllUser"><span class="glyphicon glyphicon-unchecked"></span> 全选</a>
                                                <a class="btn btn-danger" id="delAllUser"><span class="glyphicon glyphicon-trash"></span> 批量删除</a>
                                                {else}
                                                <a class="btn btn-primary disabled" id="checkAllUser"><span class="glyphicon glyphicon-unchecked"></span> 全选</a>
                                                <a class="btn btn-danger disabled" id="delAllUser"><span class="glyphicon glyphicon-trash"></span> 批量删除</a>
                                                {/if}
                                            </div>
                                            <div class="col-md-5">
                                                <div class="col-md-2 control-input">
                                                    {if $pageInfo.search!='' && $pageInfo.keywords!=''}
                                                    <a class="btn btn-default" href="{U('admin/user/page/1')}"><span class="glyphicon glyphicon-refresh"></span> 清空</a>
                                                    {/if}
                                                </div>
                                                <div class="col-md-3 control-input">
                                                    <select class="form-control" id="search">
                                                        <option value="username"{if $pageInfo.search=='username'}selected="selected"{/if}>用户名</option>
                                                        <option value="id"{if $pageInfo.search=='id'}selected="selected"{/if}>ID</option>
                                                        <option value="truename"{if $pageInfo.search=='truename'}selected="selected"{/if}>姓名</option>
                                                        <option value="moblie"{if $pageInfo.search=='moblie'}selected="selected"{/if}>电话</option>
                                                        <option value="telephone"{if $pageInfo.search=='telephone'}selected="selected"{/if}>手机</option>
                                                        <option value="email"{if $pageInfo.search=='email'}selected="selected"{/if}>email</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-7 control-input">
                                                    <div class="input-group">
                                                        <input type="text" class="form-control" placeholder="搜索您想要的..." name="search" id="input-search" value="{$pageInfo.keywords}">
                                                        <div class="input-group-btn">
                                                            <button class="btn btn-default" type="button" id="btn-search"><i class="glyphicon glyphicon-search"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div class="col-sm-12">
                                                <!-- 没有搜索,没有数据的情况 -->
                                                {if $pageInfo.search=='' && $pageInfo.keywords=='' && $pageInfo.total==0}
                                                    <div id="tip" class="alert alert-warning alert-dismissible">暂无用户</div>
                                                {/if}
                                                <!-- 有搜索,没有数据的情况 -->
                                                {if $pageInfo.search!='' && $pageInfo.keywords!='' && $pageInfo.total==0}
                                                    <div id="tip" class="alert alert-warning alert-dismissible">暂无<strong>
                                                    {if $pageInfo.search == 'username'}
                                                    用户名
                                                    {elseif $pageInfo.search == 'id'}
                                                    ID
                                                    {elseif $pageInfo.search == 'truename'}
                                                    姓名
                                                    {elseif $pageInfo.search == 'moblie'}
                                                    电话
                                                    {elseif $pageInfo.search == 'telephone'}
                                                    手机
                                                    {elseif $pageInfo.search == 'email'}
                                                    邮箱
                                                    {/if}
                                                    </strong>为<strong> {$pageInfo.keywords} </strong>的数据</div>
                                                {/if}
                                                <!-- 有数据的情况 -->
                                                {if $pageInfo.total!=0}
                                                <table class="table table-striped table-condensed table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th style="width:20px" >#</th>
                                                            <th style="width:40px">ID</th>
                                                            <th style="width:120px">用户名</th>
                                                            <th style="width:100px" >用户组</th>
                                                            <th style="width:80px" >姓名</th>
                                                            <th style="width:50px">性别</th>
                                                            <th style="width:190px" >Email</th>
                                                            <th style="width:50px">积分</th>
                                                            <th style="width:50px">状态</th>
                                                            <th style="width:180px">注册日期</th>
                                                            <th style="width:110px">手机</th>
                                                            <th style="width:160px">操作</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                    {foreach from=$userList item=v}
                                                        <tr>
                                                            <td><input type="checkbox" name="checklist[]" /></td>
                                                            <td>{$v.id}</td>
                                                            <td>{$v.username}</td>
                                                            <td>{$v.group_id}</td>
                                                            <td>{$v.true_name}</td>
                                                            <td>{$v.sex}</td>
                                                            <td>{$v.email}</td>
                                                            <td>{$v.point}</td>
                                                            <td>{$v.status}</td>
                                                            <td>{$v.reg_time}</td>
                                                            <td>{$v.telephone}</td>
                                                            <td>
                                                                <a class="btn btn-sm btn-success" href="{U('admin/user/page/'|cat:{$pageInfo.page}|cat:'/action/edituser/id/'|cat:{$v.id})}"><span class="glyphicon glyphicon-edit"></span> 编辑</a>
                                                                <a class="btn btn-sm btn-danger btn-delUser" href="javascript:void(0);" ><span class="glyphicon glyphicon-remove"></span> 删除</a>
                                                            </td>
                                                        </tr>
                                                    {/foreach}
                                                {/if}
                                                    </tbody>
                                                </table>
                                                <!-- 有数据的情况 -->
                                                {if $pageInfo.total!=0}
                                                <hr>
                                                共{$pageInfo.pageCount}页，当前第{$pageInfo.page}页，本页显示{$pageInfo.rows}条记录，共{$pageInfo.total}条记录
                                                <nav>
                                                    <ul class="pagination pull-left">
                                                        <li>
                                                            <a href="{U('admin/user/page/1')}&search={$pageInfo.search}&keywords={$pageInfo.keywords}" aria-label="Previous"> <span class="glyphicon glyphicon-step-backward"></span>
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="{U('admin/user/page/')}{$pageInfo.page-1}&search={$pageInfo.search}&keywords={$pageInfo.keywords}" aria-label="Previous"> <span class="glyphicon glyphicon-chevron-left"></span>
                                                            </a>
                                                        </li>
                                                        {if $pageInfo.startBanner=='...'}
                                                            <li><a href="javascript:void(0);">...</a></li>
                                                        {/if}
                                                    {section name=total loop=$pageInfo.pageCount}
                                                        {if $smarty.section.total.index+1==$pageInfo.page }
                                                            <li class="active"><a href="javascript:void(0);">{$smarty.section.total.index+1}</a></li>
                                                        {else}
                                                            {if (($smarty.section.total.index+1>=$pageInfo.start) && ($smarty.section.total.index+1<=$pageInfo.end))}
                                                                <li><a href="{U('admin/user/page/')}{$smarty.section.total.index+1}&search={$pageInfo.search}&keywords={$pageInfo.keywords}">{$smarty.section.total.index+1}</a></li>
                                                            {/if}
                                                        {/if}
                                                    {/section}
                                                        {if $pageInfo.endBanner=='...'}
                                                            <li><a href="javascript:void(0);">...</a></li>
                                                        {/if}
                                                        <li>
                                                            <a href="{U('admin/user/page/')}{$pageInfo.page+1}&search={$pageInfo.search}&keywords={$pageInfo.keywords}" aria-label="Next"> <span class="glyphicon glyphicon-chevron-right"></span>
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="{U('admin/user/page/')}{$pageInfo.pageCount}&search={$pageInfo.search}&keywords={$pageInfo.keywords}" aria-label="Next"> <span class="glyphicon glyphicon-step-forward"></span>
                                                            </a>
                                                        </li>
                                                    </ul>
                                                    <div class="col-md-2 pull-left" style="margin:20px 0;">
                                                        <select class="form-control" id="select-gotoPage">
                                                        {section name=total loop=$pageInfo.pageCount}
                                                            {if $smarty.section.total.index+1==$pageInfo.page}
                                                                <option value="{$smarty.section.total.index+1}" selected="selected">{$smarty.section.total.index+1}</option>
                                                            {else}
                                                                <option value="{$smarty.section.total.index+1}">{$smarty.section.total.index+1}</option>
                                                            {/if}
                                                        {/section}
                                                        </select>
                                                    </div>
                                                    <button type="button" class="btn btn-default" style="margin:20px 0;" id="btn-gotoPage">走你</button>
                                                </nav>
                                                {/if}<!-- 有数据的情况 END -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 用户组 -->
                        <div role="tabpanel" class="tab-pane fade " id="groupList">
                            <div class="row">
                                <div class="col-md-12">
                                    <form class="form-horizontal">
                                        <div class="form-group">
                                            <div class="col-md-12">
                                                <a class="btn btn-success" data-toggle="modal" data-target="#addGroupModal"><span class="glyphicon glyphicon-plus"></span> 添加用户组</a>
                                                <button type="button" class="btn btn-primary" id="checkAllGroup"><span class="glyphicon glyphicon-unchecked"></span> 全选</button>
                                                <button type="button" class="btn btn-danger" id="delAllGroup"><span class="glyphicon glyphicon-trash"></span> 批量删除</button>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div class="col-sm-12">
                                                <table class="table table-striped table-condensed table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th style="width:20px">#</th>
                                                            <th style="width:40px">ID</th>
                                                            <th>组名</th>
                                                            <th>折扣率</th>
                                                            <th>最小经验</th>
                                                            <th>最大经验</th>
                                                            <th style="width:160px">操作</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                    {foreach from=$groupList item=v}
                                                        <tr>
                                                            <td><input type="checkbox" name="checklist[]" />
                                                            </td>
                                                            <td>{$v.id}</td>
                                                            <td>{$v.name}</td>
                                                            <td>{$v.discount}</td>
                                                            <td>{$v.minexp}</td>
                                                            <td>{$v.maxexp}</td>
                                                            <td>
                                                                <button class="btn btn-sm btn-success btn-editGroupRun" type="button" data-toggle="modal" data-target="#editGroupModal"><span class="glyphicon glyphicon-edit"></span> 编辑</button>
                                                                <button class="btn btn-sm btn-danger btn-delGroup" type="button"><span class="glyphicon glyphicon-remove"></span> 删除</button>
                                                            </td>
                                                        </tr>
                                                    {/foreach}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>


                    </div>
                </div>
                

            </div>
        </div>
        <script type="text/javascript">
            (function($){
            $.getUrlParam
             = function(name)
            {
            var reg
             = new RegExp("(^|&)"+
             name +"=([^&]*)(&|$)");
            var r
             = window.location.search.substr(1).match(reg);
            if (r!=null) return unescape(r[2]); return null;
            }
            })(jQuery);


            if($.getUrlParam('tab')!=''){
                $("a[aria-controls='"+$.getUrlParam('tab')+"']").tab('show');
            }

            <!--
            $(document).ready( function () {
                //搜索
                $("#btn-search").click(function(){
                    location.href="{U('admin/user/page/1')}"+'&search='+$("#search").val()+'&keywords='+$("#input-search").val();
                });
                //搜索框回车
                $("#input-search").keydown(function(event){
                    if(event.keyCode ==13){
                        $("#btn-search").trigger("click");
                    }
                });
                //搜索框点击选中文字
                $("#input-search").click(function(){
                    $(this).select();
                });

                //走你
                $("#btn-gotoPage").click(function(){
                    location.href="{U('admin/user/page/')}"+$("#select-gotoPage").val()+'&search='+$("#search").val()+'&keywords='+$("#input-search").val();
                });

                //添加用户
                $("#btn-addUser").click(function(){
                    $.ajax({
                    url: "{U('Admin/user/action/adduser')}",
                    type: 'POST',
                    data:'username='+$('#input-username').val()+
                         '&password='+$('#input-password').val()+
                         '&email='+$('#input-email').val(),
                    dataType: 'html',
                    timeout: 1000,
                    success: function(html){
                        alert('添加成功!');
                        location.href="{U('admin/user/page/')}"+{$pageInfo.pageCount+1};
                    }
                    });
                });

                //删除用户
                $("#userList tbody .btn-delUser").click(function(){
                    if(confirm("确定要删除这条用户吗？")){
                        $("#userList tbody tr:eq("+$(".btn-delUser").index($(this))+")").fadeOut();
                        $.ajax({
                        url: "{U('Admin/user/action/deluser')}",
                        type: 'GET',
                        data:'id='+$("#userList tbody tr:eq("+$(".btn-delUser").index($(this))+") td:eq(1)").html(),
                        dataType: 'html',
                        timeout: 1000,
                        success: function(html){
                            location.href="{U('admin/user/page/')}"+{$pageInfo.page};
                        }
                        });
                    }
                });

                //批量删除用户
                $("#delAllUser").click(function(){
                    if(confirm("确定要删除这些用户吗？")){
                        for(i=0;i<$("#userList input[type='checkbox']").length;i++){
                            if($("#userList input[type='checkbox']:eq("+i+")").prop("checked")==true){
                                $.ajax({
                                url: "{U('Admin/user/action/deluser')}",
                                type: 'GET',
                                data:'id='+$("tbody tr:eq("+i+") td:eq(1)").html(),
                                dataType: 'html',
                                timeout: 1000,
                                });
                            }
                        }
                        setTimeout(function(){
                            location.href="{U('admin/user/page/')}"+{$pageInfo.page+1};
                        }, 1000);
                    }
                });

                //用户全选or反选
                $("#checkAllUser").click(function(){
                    if($("#checkAllUser").prop("checked") == true){
                        $("#checkAllUser").prop("checked", false);
                        $("#checkAllUser span").attr("class", "glyphicon glyphicon-unchecked");
                        $("#userList input[type='checkbox']").prop("checked", false);
                    }else{
                        $("#checkAllUser").prop("checked", true);
                        $("#checkAllUser span").attr("class", "glyphicon glyphicon-check");
                        $("#userList input[type='checkbox']").prop("checked", true);
                    }
                });

                //=============用户组===============
                

                //添加用户组
                $("#btn-addGroup").click(function(){
                    $.ajax({
                    url: "{U('Admin/user/action/addgroup')}",
                    type: 'POST',
                    data:'groupname='+$('#input-groupname').val()+
                         '&discount='+$('#input-discount').val()+
                         '&minexp='+$('#input-minexp').val()+
                         '&maxexp='+$('#input-maxexp').val(),
                    dataType: 'html',
                    timeout: 1000,
                    success: function(html){
                        location.href="{U('admin/user/tab/groupList')}";
                    }
                    });
                });


                //删除用户组
                $("#groupList tbody .btn-delGroup").click(function(){
                    if(confirm("确定要删除这条用户组吗？")){
                        $("#groupList tbody tr:eq("+$(".btn-delGroup").index($(this))+")").fadeOut();
                        $.ajax({
                        url: "{U('Admin/user/action/delgroup')}",
                        type: 'GET',
                        data:'id='+$("#groupList tbody tr:eq("+$(".btn-delGroup").index($(this))+") td:eq(1)").html(),
                        dataType: 'html',
                        timeout: 1000,
                        success: function(html){
                            location.href="{U('admin/user/tab/groupList')}";
                        }
                        });
                    }
                });

                //批量删除用户组
                $("#delAllGroup").click(function(){
                    if(confirm("确定要删除这些用户组吗？")){
                        for(i=0;i<$("#groupList input[type='checkbox']").length;i++){
                            if($("#groupList input[type='checkbox']:eq("+i+")").prop("checked")==true){
                                $.ajax({
                                url: "{U('Admin/user/action/delgroup')}",
                                type: 'GET',
                                data:'id='+$("#groupList tbody tr:eq("+i+") td:eq(1)").html(),
                                dataType: 'html',
                                timeout: 1000,
                                });
                            }
                        }
                        setTimeout(function(){
                            location.href="{U('admin/user/tab/groupList')}";
                        }, 100);
                    }
                });


                //点击修改用户组
                $("#groupList .btn-editGroupRun").click(function(){
                    $("#editGroupModal #input-editgroupid").val($("#groupList tbody tr:eq("+$(".btn-editGroupRun").index($(this))+") td:eq(1)").html());
                    $("#editGroupModal #input-editgroupname").val($("#groupList tbody tr:eq("+$(".btn-editGroupRun").index($(this))+") td:eq(2)").html());
                    $("#editGroupModal #input-editdiscount").val($("#groupList tbody tr:eq("+$(".btn-editGroupRun").index($(this))+") td:eq(3)").html());
                    $("#editGroupModal #input-editminexp").val($("#groupList tbody tr:eq("+$(".btn-editGroupRun").index($(this))+") td:eq(4)").html());
                    $("#editGroupModal #input-editmaxexp").val($("#groupList tbody tr:eq("+$(".btn-editGroupRun").index($(this))+") td:eq(5)").html());
                });

                //保存用户组
                $("#btn-editGroup").click(function(){
                    $.ajax({
                    url: "{U('Admin/user/action/editgroup')}",
                    type: 'POST',
                    data:'groupname='+$('#input-editgroupname').val()+
                         '&discount='+$('#input-editdiscount').val()+
                         '&minexp='+$('#input-editminexp').val()+
                         '&maxexp='+$('#input-editmaxexp').val()+
                         '&id='+$('#input-editgroupid').val(),
                    dataType: 'html',
                    timeout: 1000,
                    success: function(html){
                        location.href="{U('admin/user/tab/groupList')}";
                    }
                    });
                });

                //用户组全选or反选
                $("#checkAllGroup").click(function(){
                    if($("#checkAllGroup").prop("checked") == true){
                        $("#checkAllGroup").prop("checked", false);
                        $("#checkAllGroup span").attr("class", "glyphicon glyphicon-unchecked");
                        $("#groupList input[type='checkbox']").prop("checked", false);
                    }else{
                        $("#checkAllGroup").prop("checked", true);
                        $("#checkAllGroup span").attr("class", "glyphicon glyphicon-check");
                        $("#groupList input[type='checkbox']").prop("checked", true);
                    }
                });

            })
            //-->
        </script>
{include file="Admin/include/footer.html"}